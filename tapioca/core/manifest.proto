syntax = "proto3";

message PackageId {}

// The ID for a particular build
message BuildId {
  // The timestamp of the build's creation
  uint64 timestamp = 1;
  // The fprint of the
  uint64 fprint = 2;
}

message Manifest {
  PackageId package_id = 1;
  BuildId build_id = 2;
  repeated Block block = 3;
  repeated Item item = 4;
  // Required: the maximum size of blocks within the build in bytes.
  uint64 max_block_size = 5;
  // Required: the URL prefix to download objects from.
  string block_storage_prefix = 6;
}

// A manifest descriptor for a block within a build
message Block {
  // The hash of the block
  bytes hash = 1;
  // Optional: The size of the block. Only present when the size of the block is
  // not the max_block_size of the manifest.
  uint64 size = 2;
}

// A manifest descriptor for a item (a file or directory) within a build
message Item {
  string name = 1;

  oneof descriptor {
    File file = 2;
    Directory directory = 3;
  }

  message File {
    bytes hash = 1;
    uint64 size = 2;
    // The sequence of blocks that consitute the file. The ID corresponds to the
    // index of the block in the manifest.
    repeated uint64 block_ids = 3;
  }

  message Directory {
    repeated Item children = 1;
  }
}
